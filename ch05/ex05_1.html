<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>é‡åŠ›è¿·å®®éŠæˆ²</title>

<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #f0f0f0;
    font-family: sans-serif;
    text-align: center;
  }
  #title {
    margin-top: 15px;
    font-size: 22px;
    font-weight: bold;
  }
  #msg {
    margin-top: 5px;
    width: 100%;
    color: #333;
    font-size: 18px;
  }
  canvas {
    background: #ffffff;
    display: block;
    margin: 10px auto 0 auto;
    border: 2px solid #000;
  }
  #startBtn, #resetBtn {
    margin-top: 10px;
    padding: 10px 20px;
    font-size: 18px;
  }
  #timeBox {
    margin-top: 10px;
    font-size: 18px;
  }
  #timer {
    font-size: 22px;
    color: #e74c3c;
    font-weight: bold;
    margin-top: 5px;
  }
</style>
</head>

<body>

<!--
========================================================
 DeviceOrientation + DeviceMotion æ•´åˆç¤ºç¯„

 1. DeviceOrientation API â€” å–å¾—æ‰‹æ©Ÿæ—‹è½‰è§’åº¦
    - ä½¿ç”¨ alpha / beta / gammaï¼ˆæˆ– Z / X / Y è»¸æ—‹è½‰ï¼‰
    - ç”¨ä¾†åˆ¤æ–·æ‰‹æ©Ÿå‚¾æ–œæ–¹å‘ï¼ˆæ±ºå®šå°çƒçš„ç§»å‹•æ–¹å‘ï¼‰

 2. DeviceMotion API â€” å–å¾—åŠ é€Ÿåº¦èˆ‡é‡åŠ›æ–¹å‘
    - ä½¿ç”¨ accelerationIncludingGravity å–å¾—ï¼š
        axï¼ˆXè»¸åŠ é€Ÿåº¦ï¼‰
        ayï¼ˆYè»¸åŠ é€Ÿåº¦ï¼‰
        azï¼ˆZè»¸åŠ é€Ÿåº¦ï¼‰
    - ä½¿å°çƒç§»å‹•æ›´æ¥è¿‘çœŸå¯¦ç‰©ç†æ•ˆæœï¼ˆå‚¾æ–œ â†’ ä¸‹æ»‘ï¼‰

 æœ¬ç¨‹å¼ç¤ºç¯„ï¼š
    - æ„Ÿæ¸¬å™¨è³‡æ–™è®€å–ï¼ˆorientation + motionï¼‰
    - å³æ™‚æ›´æ–°å°çƒä½ç½®
    - è¨ˆæ™‚å™¨ + éŠæˆ²å‹è² åˆ¤å®š
========================================================
-->

<h2 id="title">DeviceOrientation + DeviceMotion æ•´åˆç¤ºç¯„</h2>

<div id="msg">è¼¸å…¥æŒ‘æˆ°æ™‚é–“å¾Œé–‹å§‹éŠæˆ²</div>

<!-- ä½¿ç”¨è€…è¼¸å…¥æŒ‘æˆ°ç§’æ•¸ -->
<div id="timeBox">
  æŒ‘æˆ°æ™‚é–“ï¼š<input id="timeInput" type="number" value="10" min="1" style="width:70px;"> ç§’
</div>

<button id="startBtn">é–‹å§‹éŠæˆ²</button>
<button id="resetBtn" style="display:none;">é‡æ–°æŒ‘æˆ°</button>

<!-- é¡¯ç¤ºå€’æ•¸ -->
<div id="timer"></div>

<canvas id="game" width="360" height="600"></canvas>

<script>
// === åŸºæœ¬è¨­å®š ===
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let ball = { x: 50, y: 50, radius: 10, vx: 0, vy: 0 };
let beta = 0;  
let gamma = 0; 
let playing = false;

let timeLimit = 10;        
let remainingTime = 10;    
let timerRunning = false;

const msg = document.getElementById("msg");
const timerEl = document.getElementById("timer");
const startBtn = document.getElementById("startBtn");
const resetBtn = document.getElementById("resetBtn");
const timeInput = document.getElementById("timeInput");

// === è¿·å®®ç‰†å£ ===
const walls = [
  {x: 0, y: 100, w: 260, h: 20},
  {x: 100, y: 200, w: 260, h: 20},
  {x: 0, y: 300, w: 260, h: 20},
  {x: 100, y: 400, w: 260, h: 20},
];

// === æ´å£ ===
const holes = [
  {x: 180, y: 150, r: 18},
  {x: 70, y: 350, r: 18},
];

// === çµ‚é» ===
const goal = {x: 280, y: 520, w: 50, h: 50};


// =========================
// é–‹å§‹éŠæˆ²
// =========================
startBtn.addEventListener("click", async () => {
  timeLimit = Number(timeInput.value) || 10;
  remainingTime = timeLimit;
  timerEl.textContent = remainingTime + " ç§’";

  if (window.DeviceOrientationEvent && DeviceOrientationEvent.requestPermission) {
    try {
      const permission = await DeviceOrientationEvent.requestPermission();
      if (permission !== "granted") {
        alert("æœªå…è¨±æ„Ÿæ¸¬å™¨ï¼Œç„¡æ³•ç©éŠæˆ²");
        return;
      }
    } catch (e) {
      alert("æ„Ÿæ¸¬å™¨æ¬Šé™éŒ¯èª¤ï¼š" + e);
      return;
    }
  }

  msg.textContent = "å‚¾æ–œæ‰‹æ©Ÿæ§åˆ¶å°çƒ â€” é–‹å§‹ï¼";
  startBtn.style.display = "none";
  timeInput.style.display = "none";

  playing = true;

  startTimer();
});


// =========================
// DeviceOrientation
// =========================
window.addEventListener("deviceorientation", (event) => {
  beta = event.beta;
  gamma = event.gamma;
});


// =========================
// å€’æ•¸è¨ˆæ™‚
// =========================
function startTimer() {
  timerRunning = true;

  const interval = setInterval(() => {
    if (!timerRunning) {
      clearInterval(interval);
      return;
    }

    remainingTime--;
    timerEl.textContent = remainingTime + " ç§’";

    if (remainingTime <= 0) {
      clearInterval(interval);
      timerRunning = false;
      playing = false;
      msg.textContent = "æ™‚é–“åˆ°ï¼æŒ‘æˆ°å¤±æ•— ğŸ˜µ";
      showResetButton();
    }
  }, 1000);
}


// =========================
// é‡æ–°æŒ‘æˆ°
// =========================
resetBtn.addEventListener("click", () => {
  ball = { x: 50, y: 50, radius: 10, vx: 0, vy: 0 };
  playing = false;
  timerRunning = false;
  remainingTime = timeLimit;
  timerEl.textContent = remainingTime + " ç§’";
  msg.textContent = "è¼¸å…¥æŒ‘æˆ°æ™‚é–“å¾Œé–‹å§‹éŠæˆ²";
  startBtn.style.display = "inline-block";
  timeInput.style.display = "inline-block";
  resetBtn.style.display = "none";
});

function showResetButton() {
  resetBtn.style.display = "inline-block";
}


// =========================
// ä¸»éŠæˆ²å›åœˆ
// =========================
function loop() {
  if (playing) update();
  draw();
  requestAnimationFrame(loop);
}
loop();


// =========================
// æ›´æ–°éŠæˆ²ç‰©ç†
// =========================
function update() {
  let gx = gamma / 45;
  let gy = beta / 45;

  ball.vx += gx;
  ball.vy += gy;

  ball.vx *= 0.98;
  ball.vy *= 0.98;

  ball.x += ball.vx;
  ball.y += ball.vy;

  // é‚Šç•Œåå½ˆ
  if (ball.x < ball.radius || ball.x > canvas.width - ball.radius) {
    ball.vx *= -0.5;
  }
  if (ball.y < ball.radius || ball.y > canvas.height - ball.radius) {
    ball.vy *= -0.5;
  }

  // ç‰†å£
  walls.forEach(w => collideWall(w));

  // æ´å£ â†’ å¤±æ•—
  for (let h of holes) {
    let dx = ball.x - h.x;
    let dy = ball.y - h.y;
    if (Math.sqrt(dx*dx + dy*dy) < h.r) {
      playing = false;
      timerRunning = false;
      msg.textContent = "æ‰é€²æ´è£¡äº†ï¼æŒ‘æˆ°å¤±æ•— ğŸ˜µ";
      showResetButton();
      return;
    }
  }

  // çµ‚é» â†’ æˆåŠŸ
  if (ball.x > goal.x && ball.x < goal.x + goal.w &&
      ball.y > goal.y && ball.y < goal.y + goal.h) {
    playing = false;
    timerRunning = false;
    msg.textContent = "æ­å–œéé—œï¼ğŸ‰";
    showResetButton();
  }
}


// =========================
// çƒ vs ç‰†å£
// =========================
function collideWall(w) {
  if (ball.x + ball.radius > w.x &&
      ball.x - ball.radius < w.x + w.w &&
      ball.y + ball.radius > w.y &&
      ball.y - ball.radius < w.y + w.h) {

    if (ball.x < w.x || ball.x > w.x + w.w) ball.vx *= -0.5;
    if (ball.y < w.y || ball.y > w.y + w.h) ball.vy *= -0.5;
  }
}


// =========================
// ç¹ªè£½ç•«é¢
// =========================
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // çµ‚é»
  ctx.fillStyle = "#2ecc71";
  ctx.fillRect(goal.x, goal.y, goal.w, goal.h);

  // ç‰†å£
  ctx.fillStyle = "#333";
  walls.forEach(w => ctx.fillRect(w.x, w.y, w.w, w.h));

  // æ´å£
  ctx.fillStyle = "#444";
  holes.forEach(h => {
    ctx.beginPath();
    ctx.arc(h.x, h.y, h.r, 0, Math.PI * 2);
    ctx.fill();
  });

  // å°çƒ
  ctx.fillStyle = "#3498db";
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
  ctx.fill();
}
</script>
</body>
</html>
