<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>é‡åŠ›è¿·å®®éŠæˆ²</title>

<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #f0f0f0;
    font-family: sans-serif;
    text-align: center;
  }
  #title {
    margin-top: 15px;
    font-size: 22px;
    font-weight: bold;
  }
  #msg {
    margin-top: 5px;
    width: 100%;
    color: #333;
    font-size: 18px;
  }
  canvas {
    background: #ffffff;
    display: block;
    margin: 10px auto 0 auto;
    border: 2px solid #000;
  }
  #startBtn {
    margin-top: 10px;
    padding: 10px 20px;
    font-size: 18px;
  }
</style>
</head>

<body>

<!-- ğŸ”¥ ä½œæ¥­ä¸»é¡Œ -->
<h2 id="title">DeviceOrientation + DeviceMotion æ•´åˆç¤ºç¯„</h2>

<div id="msg">å…è¨±è®€å–æ„Ÿæ¸¬å™¨å¾Œé–‹å§‹éŠæˆ²</div>
<button id="startBtn">é–‹å§‹éŠæˆ²</button>
<canvas id="game" width="360" height="600"></canvas>

<script>
// === åŸºæœ¬è¨­å®š ===
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let ball = { x: 50, y: 50, radius: 10, vx: 0, vy: 0 };
let beta = 0;  // å‰å¾Œ
let gamma = 0; // å·¦å³
let playing = false;

const msg = document.getElementById("msg");

// === è¿·å®®ç‰†å£ ===
const walls = [
  {x: 0, y: 100, w: 260, h: 20},
  {x: 100, y: 200, w: 260, h: 20},
  {x: 0, y: 300, w: 260, h: 20},
  {x: 100, y: 400, w: 260, h: 20},
];

// === æ´å£ ===
const holes = [
  {x: 180, y: 150, r: 18},
  {x: 70, y: 350, r: 18},
];

// === çµ‚é» ===
const goal = {x: 280, y: 520, w: 50, h: 50};


// =========================
// å…è¨±æ„Ÿæ¸¬å™¨æŒ‰éˆ•
// =========================
document.getElementById("startBtn").addEventListener("click", async () => {
  if (window.DeviceOrientationEvent && DeviceOrientationEvent.requestPermission) {
    try {
      const permission = await DeviceOrientationEvent.requestPermission();
      if (permission !== "granted") {
        alert("æœªå…è¨±æ„Ÿæ¸¬å™¨ï¼Œç„¡æ³•ç©éŠæˆ²");
        return;
      }
    } catch (e) {
      alert("æ„Ÿæ¸¬å™¨æ¬Šé™éŒ¯èª¤ï¼š" + e);
      return;
    }
  }

  msg.textContent = "å‚¾æ–œæ‰‹æ©Ÿæ§åˆ¶å°çƒ â€” é–‹å§‹ï¼";
  document.getElementById("startBtn").style.display = "none";
  playing = true;
});


// =========================
// è®€å– DeviceOrientation
// =========================
window.addEventListener("deviceorientation", (event) => {
  beta = event.beta;
  gamma = event.gamma;
});


// =========================
// ä¸»éŠæˆ²å›åœˆ
// =========================
function loop() {
  if (playing) update();
  draw();
  requestAnimationFrame(loop);
}
loop();


// =========================
// æ›´æ–°ç‰©ç†
// =========================
function update() {

  // å‚¾æ–œæ§åˆ¶é‡åŠ›æ–¹å‘
  let gx = gamma / 45;
  let gy = beta / 45;

  // åŠ é€Ÿåº¦ï¼ˆæ¨¡æ“¬é‡åŠ›ï¼‰
  ball.vx += gx;
  ball.vy += gy;

  // æ‘©æ“¦åŠ›
  ball.vx *= 0.98;
  ball.vy *= 0.98;

  // æ›´æ–°ä½ç½®
  ball.x += ball.vx;
  ball.y += ball.vy;

  // é‚Šç•Œåå½ˆ
  if (ball.x < ball.radius || ball.x > canvas.width - ball.radius) {
    ball.vx *= -0.5;
  }
  if (ball.y < ball.radius || ball.y > canvas.height - ball.radius) {
    ball.vy *= -0.5;
  }

  // ç‰†å£ç¢°æ’
  walls.forEach(w => collideWall(w));

  // æ´å£ -> Game Over
  for (let h of holes) {
    let dx = ball.x - h.x;
    let dy = ball.y - h.y;
    if (Math.sqrt(dx*dx + dy*dy) < h.r) {
      playing = false;
      msg.textContent = "æ‰é€²æ´è£¡äº†ï¼æŒ‰ F5 é‡æ–°é–‹å§‹";
      return;
    }
  }

  // æŠµé”çµ‚é»
  if (ball.x > goal.x && ball.x < goal.x + goal.w &&
      ball.y > goal.y && ball.y < goal.y + goal.h) {
    playing = false;
    msg.textContent = "æ­å–œéé—œï¼ğŸ‰";
  }
}


// =========================
// çƒ vs ç‰†å£
// =========================
function collideWall(w) {
  if (ball.x + ball.radius > w.x &&
      ball.x - ball.radius < w.x + w.w &&
      ball.y + ball.radius > w.y &&
      ball.y - ball.radius < w.y + w.h) {

    // ç°¡å–®åå½ˆ
    if (ball.x < w.x || ball.x > w.x + w.w) ball.vx *= -0.5;
    if (ball.y < w.y || ball.y > w.y + w.h) ball.vy *= -0.5;
  }
}


// =========================
// ç¹ªè£½ç•«é¢
// =========================
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // çµ‚é»
  ctx.fillStyle = "#2ecc71";
  ctx.fillRect(goal.x, goal.y, goal.w, goal.h);

  // ç‰†å£
  ctx.fillStyle = "#333";
  walls.forEach(w => ctx.fillRect(w.x, w.y, w.w, w.h));

  // æ´å£
  ctx.fillStyle = "#444";
  holes.forEach(h => {
    ctx.beginPath();
    ctx.arc(h.x, h.y, h.r, 0, Math.PI * 2);
    ctx.fill();
  });

  // å°çƒ
  ctx.fillStyle = "#3498db";
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
  ctx.fill();
}

</script>
</body>
</html>
